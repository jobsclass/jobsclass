# 🌅 내일 아침 작업 가이드

> **작업 시간**: 약 1-2시간  
> **목표**: 모든 기능이 정상 작동하도록 완성

---

## 📋 작업 순서

### 🔴 Step 1: DB 마이그레이션 실행 (10분)

#### 1-1. Supabase 접속
https://supabase.com/dashboard → JobsClass 프로젝트 선택 → SQL Editor

#### 1-2. site_settings 테이블 생성
```sql
-- 파일: supabase/migrations/20260129_site_settings.sql 내용 복사
-- 또는 아래 명령 실행

CREATE TABLE IF NOT EXISTS site_settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  key TEXT UNIQUE NOT NULL,
  value JSONB NOT NULL DEFAULT '{}',
  category TEXT NOT NULL DEFAULT 'general',
  description TEXT,
  updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- ... (전체 파일 내용 실행)
```

#### 1-3. 서비스 타입 업데이트 실행 ⚠️ **가장 중요!**
```sql
-- 파일: supabase/migrations/20260129_update_service_types.sql 내용 전체 복사/실행
-- 이 마이그레이션이 실행되어야 서비스 등록/조회가 작동합니다!
```

#### 1-4. 검증
```sql
-- 1. products 테이블 컬럼 확인
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'products' 
  AND column_name IN ('type', 'product_type', 'category', 'image_url', 'thumbnail_url');

-- 결과: type, category, image_url만 있어야 함

-- 2. 데이터 확인
SELECT type, category, status, COUNT(*) as count
FROM products 
GROUP BY type, category, status;

-- 결과: 모든 type이 6가지 중 하나여야 함
-- online_course, mentoring, group_coaching, digital_product, project_service, community_event
```

**✅ 성공 기준**: 
- products 테이블에 type, category, image_url 컬럼 존재
- 기존 데이터가 새로운 타입으로 변환됨
- 에러 없음

---

### 🟡 Step 2: 빠른 수정 작업 (30분)

#### 2-1. 서비스 타입 라벨 표시 함수 생성
```typescript
// lib/utils/service-helpers.ts (신규 생성)
import { getAllServiceTypes, getAllCategories } from '@/lib/constants/services'

export function getServiceTypeLabel(typeId: string): string {
  const types = getAllServiceTypes()
  return types.find(t => t.id === typeId)?.name || typeId
}

export function getCategoryLabel(categoryId: string): string {
  const categories = getAllCategories()
  return categories.find(c => c.id === categoryId)?.name || categoryId
}

export function getServiceTypeIcon(typeId: string): string {
  const types = getAllServiceTypes()
  return types.find(t => t.id === typeId)?.icon || '📦'
}
```

#### 2-2. 파트너 대시보드 수정
**파일**: `app/partner/dashboard/page.tsx`

찾아서 수정:
```typescript
// Before
service_type
product_type
is_published
thumbnail_url

// After
type
type
status
image_url
```

타입 표시:
```typescript
import { getServiceTypeLabel } from '@/lib/utils/service-helpers'

// 사용
<span>{getServiceTypeLabel(service.type)}</span>
```

---

### 🟢 Step 3: 테스트 (30분)

#### 테스트 1: 마켓플레이스
```
1. /marketplace 접속
2. 필터에서 타입 선택 (6가지)
3. 필터에서 카테고리 선택 (8개)
4. 서비스 클릭 → 상세 페이지
5. 타입/카테고리 표시 확인
```

**예상 결과**: 
- ✅ 필터 작동
- ✅ 서비스 목록 표시
- ✅ 상세 페이지 정보 표시

**에러 발생 시**:
```
- "type" column does not exist → DB 마이그레이션 재실행
- 타입명이 영어로 표시 → getServiceTypeLabel 미사용
- 이미지 안 보임 → image_url 필드명 확인
```

#### 테스트 2: 서비스 등록 (파트너)
```
1. /auth/user/login (파트너 계정)
2. /dashboard/services 접속
3. "새 서비스 등록" 클릭
4. 타입/카테고리 선택 가능한지 확인
5. 등록 시도 (저장만, 발행은 나중에)
```

**예상 결과**: 
- ✅ 6가지 타입 선택 가능
- ✅ 8개 카테고리 선택 가능
- ⚠️ 저장 시 에러 발생 가능 → 폼 데이터 필드명 확인

#### 테스트 3: Admin 페이지
```
1. /admin 접속 (admin 계정 필요)
2. 대시보드 통계 확인
3. 파트너 관리 클릭 → 목록 확인
4. 서비스 관리 클릭 → 목록 확인
5. 푸터 설정 → 저장 테스트
```

**예상 결과**: 
- ✅ 모든 통계 표시
- ✅ 파트너 목록 표시
- ✅ 서비스 목록 표시 (6가지 타입 표시)
- ✅ 푸터 설정 저장

---

## 🚨 자주 발생하는 에러 및 해결법

### 에러 1: "column product_type does not exist"
**원인**: DB 마이그레이션 미실행  
**해결**: Step 1 다시 실행

### 에러 2: 서비스 타입이 영어로 표시됨 (online_course, mentoring 등)
**원인**: 라벨 변환 함수 미사용  
**해결**: `getServiceTypeLabel()` 함수 사용

### 에러 3: 이미지가 표시 안 됨
**원인**: thumbnail_url → image_url 변경 필요  
**해결**: 해당 파일에서 필드명 변경

### 에러 4: "type" CHECK constraint violation
**원인**: 잘못된 타입 값 전송  
**해결**: 6가지 타입 중 하나만 사용
- online_course
- mentoring
- group_coaching
- digital_product
- project_service
- community_event

### 에러 5: Admin 권한 없음
**원인**: user_profiles에 is_admin = true 없음  
**해결**:
```sql
-- 본인 계정을 admin으로 설정
UPDATE user_profiles 
SET is_admin = true, role = 'admin'
WHERE email = 'your@email.com';
```

---

## 📝 우선순위별 수정 작업

### 🔴 필수 (테스트 전 필수)
1. ✅ DB 마이그레이션 실행
2. ⚠️ 파트너 대시보드 필드명 수정
3. ⚠️ 서비스 등록 폼 타입/카테고리 수정

### 🟡 중요 (테스트 후 수정)
4. 서비스 타입 라벨 표시 추가
5. 에러 메시지 한글화
6. 빈 상태 UI 개선

### 🟢 선택 (시간 되면)
7. 푸터 동적 데이터 연동
8. 이미지 업로드 개선
9. 로딩 애니메이션 추가

---

## 📊 작업 체크리스트

### 코드 수정
- [ ] DB 마이그레이션 2개 실행
- [ ] service-helpers.ts 생성
- [ ] partner/dashboard/page.tsx 수정
- [ ] client/dashboard/page.tsx 수정
- [ ] dashboard/page.tsx 수정

### 테스트
- [ ] 마켓플레이스 필터 작동
- [ ] 서비스 상세 페이지 표시
- [ ] 서비스 등록 작동
- [ ] 파트너 대시보드 표시
- [ ] Admin 페이지 작동

### 문서
- [ ] 버그 리스트 작성
- [ ] 개선 사항 정리

---

## 💡 빠른 디버깅 팁

### Console에서 확인
```javascript
// 브라우저 Console에서 실행
// 1. 현재 필터 상태
console.log('타입 필터:', selectedType)
console.log('카테고리 필터:', selectedCategory)

// 2. 서비스 데이터
console.log('서비스 목록:', services)
console.log('첫 번째 서비스:', services[0])
```

### Network 탭 확인
```
1. F12 → Network 탭
2. 페이지 새로고침
3. API 요청 확인
   - /api/products
   - /api/services/list
4. Response 데이터 확인
   - type, category 필드 존재 여부
   - 값이 6가지 타입 중 하나인지
```

### Supabase에서 직접 확인
```sql
-- 최근 생성된 서비스 10개
SELECT id, title, type, category, status, created_at
FROM products
ORDER BY created_at DESC
LIMIT 10;

-- 타입별 개수
SELECT type, COUNT(*) 
FROM products 
GROUP BY type;

-- 잘못된 타입 찾기
SELECT * FROM products
WHERE type NOT IN (
  'online_course', 'mentoring', 'group_coaching',
  'digital_product', 'project_service', 'community_event'
);
```

---

## 🎯 최종 목표

**오늘 끝내야 할 것**:
1. ✅ DB 마이그레이션 실행
2. ✅ 기본 기능 작동 (등록, 조회, 필터)
3. ✅ Admin 페이지 작동

**나중에 해도 되는 것**:
- 세부 UI 개선
- 에러 메시지 개선
- 추가 기능

---

## 📞 도움이 필요하면

각 단계에서 막히면:
1. 에러 메시지 전체 복사
2. 어떤 작업 중이었는지
3. 어떤 페이지에서 발생했는지

이 정보와 함께 질문하시면 빠르게 해결해드리겠습니다!

---

**화이팅! 🚀**

모든 준비는 다 되어 있습니다. DB 마이그레이션만 실행하면 대부분 작동할 것입니다!
